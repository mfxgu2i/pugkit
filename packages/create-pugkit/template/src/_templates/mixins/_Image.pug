//- ============================================================
//- Image mixin
//- ============================================================
//- imageInfoヘルパーを使用して画像のメタデータ・パスを自動解決します。
//- ※ src/配下の画像のみ対応。public/配下の画像は非対応。
//-
//- 引数
//-   path  {string}  img/配下の画像パス
//-   args  {object}  オプション
//-     alt           {string}  代替テキスト（デフォルト: ''）
//-     media         {string}  SP 用ブレークポイントキー 'sm' | 'md' | 'lg'（デフォルト: 'md'）
//-     lazy          {boolean} 遅延読み込み（デフォルト: true）
//-     class         {string}  img / picture 要素のクラス
//-
//- 使用例
//-   +Image('hero.jpg', { alt: '', media: 'md', lazy: true, class: '' })

mixin Image(path, args = {})
  -
    const info          = imageInfo(`${Builder.dir}assets/img/${path}`)
    const alt           = args.alt || ''
    const media         = BREAK_POINTS[args.media] || BREAK_POINTS.md
    const loading       = args.lazy !== false ? 'lazy' : undefined
    const fetchpriority = args.lazy === false ? 'high' : undefined

    // 2x画像が存在する場合のみsrcsetに含める
    const imgSrcset = (!info.isSvg && info.retina)
      ? `${info.src} 1x, ${info.retina.src} 2x`
      : undefined

  picture(class=args.class)

    //- _sp画像が存在する場合のみ出力
    if info.sp && !info.isSvg
      source(
        media=media
        srcset=info.sp.src
        width=info.sp.width
        height=info.sp.height
      )
    img(
      src=info.src
      srcset=imgSrcset
      alt=alt
      width=info.width
      height=info.height
      loading=loading
      fetchpriority=fetchpriority
    )
