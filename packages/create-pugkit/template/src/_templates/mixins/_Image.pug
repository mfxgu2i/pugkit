//- ============================================================
//- Image mixin 
//- ============================================================
//- 引数
//-   path  {string}  img/ 以下の画像パス（必須）
//-   args  {object}  オプション
//-     alt           {string}  代替テキスト（デフォルト: ''）
//-     lazy          {boolean} 遅延読み込み（デフォルト: true）
//-     webp          {boolean} WebP source を出力するか（デフォルト: true）
//-     class         {string}  picture 要素のクラス

//- 使用例
//-   +Image('hero.jpg')
//-   +Image('hero.jpg', { alt: 'ヒーロー画像', lazy: false })
mixin Image(path, args = {})
  -
    const src   = `${Builder.dir}assets/img/${path}`;
    const ext   = src.slice(src.lastIndexOf('.'));
    const isSvg = ext === '.svg';

    const base = src.substring(0, src.lastIndexOf('.'));
    const webpPath   = `${base}.webp`;
    const retinaWebp = `${base}@2x.webp 2x`;

    const alt           = args.alt || '';
    const loading       = args.lazy !== false ? 'lazy' : undefined;
    const fetchpriority = args.lazy === false ? 'high' : undefined;
    const width  = imageSize(src).width;
    const height = imageSize(src).height;

    // SVG は retina 不要のため 1x のみ。ラスター画像は 1x + 2x
    const webpSrcset = isSvg ? webpPath : `${webpPath} 1x, ${retinaWebp}`;

  picture(class=args.class)
    if !isSvg && args.webp !== false
      source(type='image/webp' srcset=webpSrcset)
    img(
      src=isSvg ? src : webpPath
      alt=alt
      width=width
      height=height
      loading=loading
      fetchpriority=fetchpriority
    )

//- ============================================================
//- ResponsiveImage mixin — レスポンシブ対応画像
//- ============================================================
//- 引数 ※ SVG は非対応。ラスター画像（jpg / png / webp 等）のみ使用可
//-   path  {string}  img/ 以下の画像パス（必須）。SP 画像は `basename_sp.ext` を自動参照
//-   args  {object}  オプション
//-     alt           {string}  代替テキスト（デフォルト: ''）
//-     media         {string}  SP 用ブレークポイントキー 'sm' | 'md' | 'lg'（デフォルト: 'md'）
//-     lazy          {boolean} 遅延読み込み（デフォルト: true）
//-     webp          {boolean} WebP source を出力するか（デフォルト: true）
//-     class         {string}  picture 要素のクラス

//- 使用例
//-   +ResponsiveImage('hero.jpg')
//-   +ResponsiveImage('hero.jpg', { media: 'sm', alt: 'ヒーロー画像' })
mixin ResponsiveImage(path, args = {})
  -
    const src  = `${Builder.dir}assets/img/${path}`;
    const ext  = src.slice(src.lastIndexOf('.'));

    const base       = src.substring(0, src.lastIndexOf('.'));
    const webpPath   = `${base}.webp`;
    const retinaWebp = `${base}@2x.webp 2x`;
    const spWebp     = `${base}_sp.webp`;
    const spPath     = `${base}_sp${ext}`;

    const alt           = args.alt || '';
    const media         = BREAK_POINTS[args.media] || BREAK_POINTS.md;
    const loading       = args.lazy !== false ? 'lazy' : undefined;
    const fetchpriority = args.lazy === false ? 'high' : undefined;
    const webpSrcset    = `${webpPath} 1x, ${retinaWebp}`;

    const width    = imageSize(src).width;
    const height   = imageSize(src).height;
    const spWidth  = imageSize(spPath).width;
    const spHeight = imageSize(spPath).height;

  picture(class=args.class)
    //- SP 用 source（メディアクエリ付き）
    if args.webp !== false
      source(
        type='image/webp'
        media=media
        srcset=spWebp
        width=spWidth
        height=spHeight
      )
    //- PC 用 source
    if args.webp !== false
      source(type='image/webp' srcset=webpSrcset)
    img(
      src=webpPath
      alt=alt
      width=width
      height=height
      loading=loading
      fetchpriority=fetchpriority
    )
